{% extends "base/basic.html" %}
{% block title %}{% endblock %}
{% block css %}
<style>
    .label-required-next:after {
        top: 6px;
        right: 5px;
        color: red;
        content: '*';
        position: absolute;
        margin-left: 4px;
        font-weight: 700;
        line-height: 1.8em;
    }
</style>
{% endblock %}
{% block content %}

<div class="layui-card">
    <div class="layui-card-header" style="height: 60px">
        <div class="layui-form-item layui-hide">
            <input type="text" name="VERB_ID" autocomplete="off" value="[[verb.ID]]" class="layui-input"
                   id="verb-details-verb-id">
        </div>
        <button class="layui-btn" layadmin-event="verbEdit" style="margin-top: 15px;">修改Verb</button>
        <!--        <button class="layui-btn" layadmin-event="verbPatternAdd" style="margin-top: 15px;">添加Pattern</button>-->
        <button class="layui-btn" layadmin-event="verbSampleBatchAdd" style="margin-top: 15px;">添加Sample</button>
        <button class="layui-btn" layadmin-event="verbBatchDelete" style="margin-top: 15px;">删除Sample</button>
        <button class="layui-btn" layadmin-event="verbTurnDown" style="margin-top: 15px;">驳回</button>
        <a class="layui-btn" href="api/export/export!verb_info?verbId=[[verb.ID]]" style="margin-top: 15px;">导出Verb</a>
    </div>
    <div class="layui-card-body">
        <div class="layui-form" style="padding: 20px 20px 0 0;background-color: #fff;">
            <div class="layui-form-item">
                <label class="layui-form-label">分配标注者</label>
                <div class="layui-input-inline">
                    <select name="USER_ID" lay-search id="verb-details-edit-verb-user">
                        {% if verb.userId != '' %}
                        <option value="[[verb.userId]]" selected>[[verb.userName]]</option>
                        <option value="">不分配标注者</option>
                        {% else %}
                        <option value="" selected>不分配标注者</option>
                        {% endif %}
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">参考Frame</label>
                <div class="layui-input-inline">
                    <select name="TEMP_FRAME_ID" lay-search id="verb-details-edit-verb-frame">
                        {% if verb.tempFrameId != '' %}
                        <option value="[[verb.tempFrameId]]" selected>[[verb.tempFrame]]</option>
                        <option value="">不分配参考Frame</option>
                        {% else %}
                        <option value="" selected>不分配参考Frame</option>
                        {% endif %}
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label label-required-next">Name:</label>
                <div class="layui-input-inline">
                    <input type="text" name="NAME" value="[[verb.NAME]]" required lay-verify="required"
                           placeholder="请输入name"
                           autocomplete="off" class="layui-input" style="margin-top: 20px;"
                           id="verb-details-edit-verb-name">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label label-required-next">ping yin:</label>
                <div class="layui-input-inline">
                    <input type="text" name="PIN_YIN" value="[[verb.PIN_YIN]]" required lay-verify="required"
                           placeholder="请输入pingyin"
                           autocomplete="off" class="layui-input" style="margin-top: 20px;"
                           id="verb-details-edit-verb-pinyin">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label label-required-next">Frequency:</label>
                <div class="layui-input-inline">
                    <input type="text" name="FREQUENCY" value="[[verb.FREQUENCY]]" required lay-verify="required"
                           placeholder="请输入frequency"
                           autocomplete="off" class="layui-input" style="margin-top: 20px;"
                           id="verb-details-edit-verb-frequency">
                </div>
            </div>
        </div>
        {% for pattern in verb.pattern %}
        <fieldset class="layui-elem-field layui-field-title" id="[[pattern.ID]]">
            <legend>
                [[pattern.PATTERN]]
                <a class="layui-btn layui-btn-normal layui-btn-xs" layadmin-event="verbPatternEdit"
                   style="margin-left: 10px;"
                   data-patternId="[[pattern.ID]]"><i class="layui-icon layui-icon-edit"></i>修改</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" layadmin-event="verbPatternDel"
                   data-patternId="[[pattern.ID]]">
                    <i class="layui-icon layui-icon-delete"></i>删除</a>
            </legend>
            <div class="layui-field-box">
                {% for sample in pattern.samples %}
                <input type="checkbox" name="verbSampleCheck" value="[[sample.ID]]" style="float:left;margin-top: 6px;">
                <p layadmin-event="clickVerbSample" data-sampleId="[[sample.ID]]">&nbsp<b>•</b> [[sample.CONTENT]]</p>
                {% endfor %}
            </div>
        </fieldset>
        {% endfor %}
    </div>
</div>
{% endblock %}
{% block js %}
<script>
    layui.config({
        base: '../static/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form', 'verbAbout'], function () {
        var $ = layui.$
            , form = layui.form
            , admin = layui.admin;

        admin.req({
            method: "get",
            url: 'api/user/get!user_list',
            done: function (res) {
                if (res.code == 0) {
                    for (i = 0; i < res.data.length; i++) {
                        $('#verb-details-edit-verb-user').append(new Option(res.data[i].NAME, res.data[i].ID));// 下拉菜单里添加元素
                    }
                    layui.form.render("select");//重新渲染 固定写法
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
            }
        });

        admin.req({
            method: "get",
            url: 'api/label/get!get_all_user_frame_for_select',
            done: function (res) {
                if (res.code == 0) {
                    for (i = 0; i < res.data.length; i++) {
                        $('#verb-details-edit-verb-frame').append(new Option(res.data[i].NAME, res.data[i].ID));// 下拉菜单里添加元素
                    }
                    layui.form.render("select");//重新渲染 固定写法
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
            }
        });

        admin.events.verbTurnDown = function (othis) {
            layer.open({
                title: '驳回更改',
                content: '提交后标注者将可对该Verb重新进行编辑，确认提交？'
                , btn: ['确定']
                , yes: function (index, layero) {
                    admin.req({
                        method: "post",
                        url: 'api/data/update!verb_basic_info',
                        data: JSON.stringify({
                            'ID': $('#verb-details-verb-id').val(),
                            'IF_FINISH': '0'
                        }),
                        done: function (res) {
                            layer.msg(res.msg);
                        }
                    });
                }
                , cancel: function () {
                }
            });
        };

        parent.layer.closeAll();
    })
</script>
{% endblock %}