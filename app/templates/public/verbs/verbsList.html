{% extends "base/basic.html" %}
{% block title %}[[message.SITE_NAME]]{% endblock %}
{% block css %}{% endblock %}
{% block content %}
<div class="layui-fluid" style="padding: 0px;background-color: #F5E9F2">
    {% include 'public/head.html' %}
    <div style="margin-top: 20px;width: 80%;margin-left: 10%;padding: 20px;" id="LAY-show-home-page">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md4">
                <div class="layui-card" style="padding: 10px;">
                    <div id="frames-list-tree-all"></div>
                </div>
            </div>
            <div class="layui-col-md8" id="frameCard">
                <div class="layui-form-item layui-hide">
                    <input type="text" name="VERB_ID" autocomplete="off" value=[[verbInfo.ID]] class="layui-input"
                           id="public-verb-details-verb-id">
                </div>
                <div class="layui-card" style="padding: 20px">
                    <div style="height: 50px;">
                        <span class="layui-breadcrumb" lay-filter="breadcrumb" style="line-height: 50px;">
                            <a href="home">VerbNet</a>
                            <a href="frames">Frames</a>
                            <a href="framesList?frameId=[[verbInfo.ID]]">[[verbInfo.NAME]]</a>
                        </span>
                    </div>
                    <p style="font-size: 35px;">[[verbInfo.NAME]] [[verbInfo.PIN_YIN]]</p>
                    <br>
                    <div class="layui-input-block" style="float: right;">
                        <button type="button" class="layui-btn layui-btn-primary" id="public-verb-compare-btn"
                                style="background-color: #824976;color: #fff">Compare
                        </button>
                    </div>
                    <p style="font-size: 28px;">Frame</p><br>
                    <p>
                        {% for parent in verbInfo.parent %}
                        <a href="javascript:;" style="color: #AD5E9D" class="layuiadmin-public-frames"
                           data-frame-id="[[parent.id]]">[[parent.name]]</a>→
                        {% endfor %}
                        <a href="javascript:;" style="color: #AD5E9D" class="layuiadmin-public-verb"
                           data-frame-id="[[verbInfo.ID]]">[[verbInfo.NAME]]</a>
                    </p><br>
                    <p style="font-size: 28px;">Frame Elements</p><br>
                    <table class="layui-table">
                        <colgroup>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th><b>FE</b></th>
                            <th><b>Definition</b></th>
                            <th><b>Count</b></th>
                        </tr>
                        </thead>
                        <tbody id="public-verb-list-detail-table">
                        </tbody>
                    </table>
                    <br>
                    <p style="font-size: 28px;">Constructional Markers</p><br>
                    <table class="layui-table">
                        <colgroup>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th><b>FE</b></th>
                            <th><b>Definition</b></th>
                            <th><b>Count</b></th>
                        </tr>
                        </thead>
                        <tbody id="public-verb-list-detail-marker-table">
                        </tbody>
                    </table>
                    <br>
                    <div class="layui-input-block" style="float: right; display: none" id="public-verb-radio-order">
                        <input type="radio" name="order" value="count" checked id="public-verb-radio-count-input">
                        <span id="public-verb-text-count" style="cursor: pointer"> Order by Count</span><br><br>
                        <input type="radio" name="order" value="order" id="public-verb-radio-order-input">
                        <span id="public-verb-text-order" style="cursor: pointer"> Order by Pattern</span>
                    </div>
                    <div id="public-verb-annotations-sentences-count"></div>
                    <div id="public-verb-annotations-sentences-pattern" style="display: none"></div>
                </div>
            </div>
        </div>
    </div>
    <div style="height: 50px"></div>
</div>
{% endblock %}
{% block js %}
<script>
    layui.config({
        base: '../static/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'layer', 'publicCommon', 'tree', 'form', 'dropdown'], function () {
        var $ = layui.$,
            tree = layui.tree,
            admin = layui.admin,
            form = layui.form,
            dropdown = layui.dropdown,
            layer = layui.layer;
        layer.load(2)

        admin.req({
            method: "get",
            url: 'api/data/get!get_all_frame_with_verb',
            done: function (res) {
                if (res.code == 0) {
                    tree.render({
                        elem: '#frames-list-tree-all'
                        , data: res.data[0].children
                        , showLine: false  //是否开启连接线
                        , click: function (obj) {
                            if (obj.data.if_verb !== 1) {
                                window.location.href = "framesList?frameId=" + obj.data.id
                            } else if (obj.data.if_verb === 1) {
                                window.location.href = "verbsList?verbId=" + obj.data.id
                            }
                        }
                    });
                    // for (var i = 0; i < $('.frames-sample-text-to-html').length; i++) {
                    //     $('.frames-sample-text-to-html')[i].innerHTML = $('.frames-sample-text-to-html')[i].innerText
                    //     $('.frames-sample-text-to-html')[i].setAttribute('style', 'display: block')
                    // }
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
                layer.closeAll();
            }
        });

        admin.req({
            method: "get",
            url: 'api/public/get!get_verb_info_for_details?verbId=' + $('#public-verb-details-verb-id').val(),
            done: function (res) {
                if (res.code == 0) {
                    tableStr = ''
                    for (var i = 0; i < res.data.frame.length; i++) {
                        tableStr += '<tr><td>' + res.data.frame[i].NAME + '</td><td>' + res.data.frame[i].DEF + '</td><td>' + res.data.frame[i].COUNT + '</td></tr>'
                    }
                    $('#public-verb-list-detail-table').html(tableStr)

                    markerTableStr = ''
                    for (var i = 0; i < res.data.marker.length; i++) {
                        markerTableStr += '<tr><td>' + res.data.marker[i].NAME + '</td><td>' + res.data.marker[i].DEF + '</td><td>' + res.data.marker[i].COUNT + '</td></tr>'
                    }
                    $('#public-verb-list-detail-marker-table').html(markerTableStr)

                    annotationStr = '<p style="font-size: 25px;">Annotations(' + res.data.verb.total + ' sentences)</p><br>'
                    for (var i = 0; i < res.data.verb.pattern_info.length; i++) {
                        annotationStr += '<details open="open"><summary style="font-size: 20px;">Pattern:' + res.data.verb.pattern_info[i].PATTERN + ' (' + res.data.verb.pattern_info[i].total + ' sentences, ' + (res.data.verb.pattern_info[i].total / res.data.verb.total * 100).toFixed(2) + '% of all)</summary>'
                        for (var j = 0; j < res.data.verb.pattern_info[i].samples.length; j++) {
                            annotationStr += '<span style="font-size: 16px;">&nbsp<b>•</b> ' + res.data.verb.pattern_info[i].samples[j] + '</span><br>'
                        }
                        annotationStr += '</details><br>'
                    }
                    $('#public-verb-annotations-sentences-count').html(annotationStr)
                    $('#public-verb-radio-order').show()

                    voteStr = '<p style="font-size: 25px;">Annotations(' + res.data.vote.total + ' sentences)</p><br>'
                    for (var i = 0; i < res.data.vote.pattern_info.length; i++) {
                        voteStr += '<details open="open"><summary style="font-size: 20px;">Pattern:' + res.data.vote.pattern_info[i].PATTERN + '</summary>'
                        for (var j = 0; j < res.data.vote.pattern_info[i].samples.length; j++) {
                            voteStr += '<span style="font-size: 16px;">&nbsp<b>•</b> ' + res.data.vote.pattern_info[i].samples[j] + '</span><br>'
                        }
                        voteStr += '</details><br>'
                    }
                    $('#public-verb-annotations-sentences-pattern').html(voteStr)
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
                layer.closeAll();
            }
        });

        $('#public-verb-compare-btn').on('click', function () {
            layer.open({
                type: 2
                , title: 'Compare Lexicons...'
                , content: 'compareLayer?verbId=' + $('#public-verb-details-verb-id').val()
                , maxmin: false
                , area: ['600px', '100%']
                , success: function (layero, index) { }
            });
        });

        $('.layuiadmin-public-frames').on('click', function () {
            window.location.href = "framesList?frameId=" + $(this).data('frame-id')
        });
        $('.layuiadmin-public-verb').on('click', function () {
            window.location.href = "verbsList?verbId=" + $(this).data('frame-id')
        });

        $('#public-verb-text-count').on('click', function () {
            $('#public-verb-radio-count-input').click()
        });

        $('#public-verb-text-order').on('click', function () {
            $('#public-verb-radio-order-input').click()
        });

        $('#public-verb-radio-count-input').on('click', function () {
            $('#public-verb-annotations-sentences-count').show()
            $('#public-verb-annotations-sentences-pattern').hide()
        });
        $('#public-verb-radio-order-input').on('click', function () {
            $('#public-verb-annotations-sentences-count').hide()
            $('#public-verb-annotations-sentences-pattern').show()
        });
    });
</script>
{% endblock %}